{
  "hash": "0c971902bbbaf4eabb3c2620944a6df3",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Predicting Body Fat Percentage in Adult Males Using Multiple Regression\"\nauthor: \"Jintao Cao\"\ndate: \"2024-12-08\"\ncategories: [code, analysis, prediction]\nimage: \"image/bodyfat.jpeg\"\n---\n\n\nResearch objectives :\n\n-   A multiple regression model was constructed to predict body fat percentage in adult men.\n\n-   Compare the difference between the model predictions and the results calculated by the formula provided by Siri (1956).\n\n-   Explore which features have a significant impact on body fat percentage prediction.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load necessary libraries\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(caret)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: 程序包'caret'是用R版本4.4.2 来建造的\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n载入需要的程序包：lattice\n\n载入程序包：'caret'\n\nThe following object is masked from 'package:purrr':\n\n    lift\n```\n\n\n:::\n:::\n\n\nData source:\n\nThe dataset comes from: [Kaggle - Body Fat Prediction Datase](https://www.kaggle.com/datasets/fedesoriano/body-fat-prediction-dataset/data)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load the dataset\nbody_fat_data <- read.csv(\"data/bodyfat.csv\")\n\n# Show data structure and overview\nstr(body_fat_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t252 obs. of  15 variables:\n $ Density: num  1.07 1.09 1.04 1.08 1.03 ...\n $ BodyFat: num  12.3 6.1 25.3 10.4 28.7 20.9 19.2 12.4 4.1 11.7 ...\n $ Age    : int  23 22 22 26 24 24 26 25 25 23 ...\n $ Weight : num  154 173 154 185 184 ...\n $ Height : num  67.8 72.2 66.2 72.2 71.2 ...\n $ Neck   : num  36.2 38.5 34 37.4 34.4 39 36.4 37.8 38.1 42.1 ...\n $ Chest  : num  93.1 93.6 95.8 101.8 97.3 ...\n $ Abdomen: num  85.2 83 87.9 86.4 100 94.4 90.7 88.5 82.5 88.6 ...\n $ Hip    : num  94.5 98.7 99.2 101.2 101.9 ...\n $ Thigh  : num  59 58.7 59.6 60.1 63.2 66 58.4 60 62.9 63.1 ...\n $ Knee   : num  37.3 37.3 38.9 37.3 42.2 42 38.3 39.4 38.3 41.7 ...\n $ Ankle  : num  21.9 23.4 24 22.8 24 25.6 22.9 23.2 23.8 25 ...\n $ Biceps : num  32 30.5 28.8 32.4 32.2 35.7 31.9 30.5 35.9 35.6 ...\n $ Forearm: num  27.4 28.9 25.2 29.4 27.7 30.6 27.8 29 31.1 30 ...\n $ Wrist  : num  17.1 18.2 16.6 18.2 17.7 18.8 17.7 18.8 18.2 19.2 ...\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(body_fat_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    Density         BodyFat           Age            Weight     \n Min.   :0.995   Min.   : 0.00   Min.   :22.00   Min.   :118.5  \n 1st Qu.:1.041   1st Qu.:12.47   1st Qu.:35.75   1st Qu.:159.0  \n Median :1.055   Median :19.20   Median :43.00   Median :176.5  \n Mean   :1.056   Mean   :19.15   Mean   :44.88   Mean   :178.9  \n 3rd Qu.:1.070   3rd Qu.:25.30   3rd Qu.:54.00   3rd Qu.:197.0  \n Max.   :1.109   Max.   :47.50   Max.   :81.00   Max.   :363.1  \n     Height           Neck           Chest           Abdomen      \n Min.   :29.50   Min.   :31.10   Min.   : 79.30   Min.   : 69.40  \n 1st Qu.:68.25   1st Qu.:36.40   1st Qu.: 94.35   1st Qu.: 84.58  \n Median :70.00   Median :38.00   Median : 99.65   Median : 90.95  \n Mean   :70.15   Mean   :37.99   Mean   :100.82   Mean   : 92.56  \n 3rd Qu.:72.25   3rd Qu.:39.42   3rd Qu.:105.38   3rd Qu.: 99.33  \n Max.   :77.75   Max.   :51.20   Max.   :136.20   Max.   :148.10  \n      Hip            Thigh            Knee           Ankle          Biceps     \n Min.   : 85.0   Min.   :47.20   Min.   :33.00   Min.   :19.1   Min.   :24.80  \n 1st Qu.: 95.5   1st Qu.:56.00   1st Qu.:36.98   1st Qu.:22.0   1st Qu.:30.20  \n Median : 99.3   Median :59.00   Median :38.50   Median :22.8   Median :32.05  \n Mean   : 99.9   Mean   :59.41   Mean   :38.59   Mean   :23.1   Mean   :32.27  \n 3rd Qu.:103.5   3rd Qu.:62.35   3rd Qu.:39.92   3rd Qu.:24.0   3rd Qu.:34.33  \n Max.   :147.7   Max.   :87.30   Max.   :49.10   Max.   :33.9   Max.   :45.00  \n    Forearm          Wrist      \n Min.   :21.00   Min.   :15.80  \n 1st Qu.:27.30   1st Qu.:17.60  \n Median :28.70   Median :18.30  \n Mean   :28.66   Mean   :18.23  \n 3rd Qu.:30.00   3rd Qu.:18.80  \n Max.   :34.90   Max.   :21.40  \n```\n\n\n:::\n\n```{.r .cell-code}\n# Data cleaning\n# Filter unreasonable body fat percentage, height and weight\nbody_fat_data <- body_fat_data %>%\n  filter(BodyFat >= 0 & Height > 0 & Weight > 0)\n```\n:::\n\n\n| Column Name | Description                                                                           |\n|--------------------------|----------------------------------------------|\n| Density     | Body density, a key metric used in the Siri formula to calculate body fat percentage. |\n| BodyFat     | The actual measured body fat percentage calculated using the \"Siri Equation\".         |\n| Age         | Age of the subject (in years).                                                        |\n| Weight      | Weight of the subject (in pounds).                                                    |\n| Height      | Height of the subject (in inches).                                                    |\n| Neck        | Neck circumference (in centimeters).                                                  |\n| Chest       | Chest circumference (in centimeters).                                                 |\n| Abdomen     | Abdomen circumference (in centimeters), strongly correlated with body fat percentage. |\n| Hip         | Hip circumference (in centimeters).                                                   |\n| Thigh       | Thigh circumference (in centimeters).                                                 |\n| Knee        | Knee circumference (in centimeters).                                                  |\n| Ankle       | Ankle circumference (in centimeters).                                                 |\n| Biceps      | Biceps circumference (in centimeters), measured in a relaxed state.                   |\n| Forearm     | Forearm circumference (in centimeters).                                               |\n| Wrist       | Wrist circumference (in centimeters).                                                 |\n\nBody density calculation formula:\n\nthe body consists of two components - lean body tissue and fat tissue. Letting:\n\n-   D = Body Density (gm/cm\\^3)\n\n-   A = proportion of lean body tissue\n\n-   B = proportion of fat tissue\n\n-   A + B = 1\n\n-   a = density of lean body tissue (gm/cm\\^3) = 1.10 gm/cm\\^3\n\n-   b = density of fat tissue (gm/cm\\^3) = 0.90 gm/cm\\^3\n\n-   D = 1/\\[(A/a) + (B/b)\\]\n\nThe above equation shows that the body density calculation formula of human body is:\n\nD = 1/{B/\\[ab/(a-b)\\] - \\[b/(a-b)\\]}\n\n[Siri Equation](https://www.sciencedirect.com/science/article/abs/pii/B978148323110550011X?via%3Dihub) :\n\nBodyFat%=(Density/495)−450\n\nBy combining these two formulas, we can accurately get the body fat percentage of the human body.\n\nHowever, in daily life, we cannot easily know the proportion of fat tissue of an individual. Therefore, I try to predict the body fat percentage of an individual through the body's physical index data, such as (weight, height, waist circumference and other easily measurable indicators).\n\n1.  Construct a multiple regression model to predict the body fat percentage of adult men and conduct predictive analysis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# The data is divided into training set and test set\nset.seed(123)\ntrain_index <- createDataPartition(body_fat_data$BodyFat, p = 0.8, list = FALSE)\ntrain_data <- body_fat_data[train_index, ]\ntest_data <- body_fat_data[-train_index, ]\n\n# Build a multiple linear regression model\nmodel <- lm(BodyFat ~ Age + Weight + Height + Neck + Chest + Abdomen + Hip + Thigh + Knee + Ankle + Biceps + Forearm + Wrist, \n            data = train_data)\n\n# Show Model Summary\nsummary(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = BodyFat ~ Age + Weight + Height + Neck + Chest + \n    Abdomen + Hip + Thigh + Knee + Ankle + Biceps + Forearm + \n    Wrist, data = train_data)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-9.2586 -3.1125 -0.4363  3.2185  9.8101 \n\nCoefficients:\n             Estimate Std. Error t value Pr(>|t|)    \n(Intercept) -3.894692  19.319844  -0.202  0.84045    \nAge          0.048871   0.035688   1.369  0.17250    \nWeight      -0.074466   0.057483  -1.295  0.19674    \nHeight      -0.106533   0.099523  -1.070  0.28578    \nNeck        -0.506772   0.254816  -1.989  0.04816 *  \nChest       -0.070895   0.113980  -0.622  0.53469    \nAbdomen      1.030774   0.095086  10.840  < 2e-16 ***\nHip         -0.274507   0.160023  -1.715  0.08790 .  \nThigh        0.123006   0.163693   0.751  0.45332    \nKnee         0.005118   0.268428   0.019  0.98481    \nAnkle        0.228328   0.235083   0.971  0.33265    \nBiceps       0.284371   0.187770   1.514  0.13157    \nForearm      0.367860   0.210140   1.751  0.08164 .  \nWrist       -1.779157   0.612909  -2.903  0.00414 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 4.334 on 190 degrees of freedom\nMultiple R-squared:  0.7511,\tAdjusted R-squared:  0.7341 \nF-statistic: 44.12 on 13 and 190 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n\n```{.r .cell-code}\n# Make predictions on the test set\ntest_data$Predicted_BodyFat <- predict(model, newdata = test_data)\n\n# Show some prediction results\nhead(test_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Density BodyFat Age Weight Height Neck Chest Abdomen   Hip Thigh Knee Ankle\n7   1.0549    19.2  26 181.00  69.75 36.4 105.1    90.7 100.3  58.4 38.3  22.9\n8   1.0704    12.4  25 176.00  72.50 37.8  99.6    88.5  97.1  60.0 39.4  23.2\n13  1.0513    20.8  32 180.50  69.50 38.4 102.0    91.6 103.9  63.4 38.3  21.5\n29  1.0910     3.7  27 133.25  64.75 36.4  93.5    73.9  88.5  50.1 34.5  21.3\n37  1.0438    24.2  40 202.25  70.00 38.5 106.5   100.9 106.2  63.5 39.9  22.6\n38  1.0346    28.4  50 196.75  68.25 42.1 105.6    98.8 104.8  66.0 41.5  24.7\n   Biceps Forearm Wrist Predicted_BodyFat\n7    31.9    27.8  17.7          16.94264\n8    30.5    29.0  18.8          13.62147\n13   32.5    28.6  17.7          17.20571\n29   30.5    27.9  17.2           6.94700\n37   35.1    30.6  19.0          23.94273\n38   33.2    30.5  19.4          20.99298\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Scatter plot for Actual vs Predicted\nggplot(test_data, aes(x = BodyFat, y = Predicted_BodyFat)) +\n  geom_point(color = \"blue\", alpha = 0.6) +\n  geom_abline(slope = 1, intercept = 0, color = \"red\", linetype = \"dashed\") +\n  labs(title = \"Actual vs Predicted Body Fat\",\n       x = \"Actual Body Fat (%)\",\n       y = \"Predicted Body Fat (%)\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Calculate MSE and MAE\nmse <- mean((test_data$BodyFat - test_data$Predicted_BodyFat)^2)\nmae <- mean(abs(test_data$BodyFat - test_data$Predicted_BodyFat))\n\n# Print error metrics\ncat(\"Mean Squared Error (MSE):\", mse, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMean Squared Error (MSE): 18.72915 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Mean Absolute Error (MAE):\", mae, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMean Absolute Error (MAE): 3.441033 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Reshape data for box plot\ncomparison <- test_data %>%\n  select(BodyFat, Predicted_BodyFat) %>%\n  pivot_longer(cols = c(BodyFat, Predicted_BodyFat),\n               names_to = \"Method\",\n               values_to = \"BodyFat\")\n\n# Box plot comparison\nggplot(comparison, aes(x = Method, y = BodyFat, fill = Method)) +\n  geom_boxplot() +\n  labs(title = \"Distribution of Actual and Predicted Body Fat\",\n       x = \"Method\",\n       y = \"Body Fat (%)\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n:::\n\n\nThe data or visual analysis reports show that there are differences in the predictions.\n\nThinking: Not all body indicators in the data set are related to body fat percentage. Calculate the impact of body indicators on body fat percentage.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate the impact of important characteristics on body fat percentage\nimportance <- varImp(model, scale = FALSE)\n\n# Display feature importance\nimportance %>%\n  as.data.frame() %>%\n  rownames_to_column(\"Feature\") %>%\n  ggplot(aes(x = reorder(Feature, Overall), y = Overall)) +\n  geom_bar(stat = \"identity\", fill = \"steelblue\") +\n  coord_flip() +\n  labs(title = \"Feature Importance\", \n       x = \"Feature\", \n       y = \"Importance score\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nAbdomen, chest, neck, forearm, hip and biceps are the most influential in predicting body fat percentage.\n\nUse these 6 body indicators to build a multiple linear regression model\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Extract the top six features with the highest importance scores\ntop_features <- c(\"Abdomen\", \"Wrist\", \"Neck\", \"Forearm\", \"Hip\", \"Biceps\")\n\n# Build a new model\nnew_model <- lm(BodyFat ~ Abdomen + Wrist + Neck + Forearm + Hip + Biceps, data = train_data)\n\n# Show new model summary\nsummary(new_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = BodyFat ~ Abdomen + Wrist + Neck + Forearm + Hip + \n    Biceps, data = train_data)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-9.2667 -3.1079 -0.4602  2.9265 11.0899 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 13.27239    7.46391   1.778 0.076912 .  \nAbdomen      1.02298    0.06099  16.773  < 2e-16 ***\nWrist       -1.85079    0.52519  -3.524 0.000528 ***\nNeck        -0.70250    0.23913  -2.938 0.003701 ** \nForearm      0.25447    0.20616   1.234 0.218545    \nHip         -0.42451    0.09510  -4.464 1.35e-05 ***\nBiceps       0.21006    0.17402   1.207 0.228835    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 4.386 on 197 degrees of freedom\nMultiple R-squared:  0.7358,\tAdjusted R-squared:  0.7277 \nF-statistic: 91.43 on 6 and 197 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n\n```{.r .cell-code}\n# Make predictions on the test set\ntest_data$Predicted_BodyFat_New <- predict(new_model, newdata = test_data)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Scatter plot: actual values ​​vs new predicted values\nggplot(test_data, aes(x = BodyFat, y = Predicted_BodyFat_New)) +\n  geom_point(color = \"blue\", alpha = 0.6) +\n  geom_abline(slope = 1, intercept = 0, color = \"red\", linetype = \"dashed\") +\n  labs(title = \"Actual value vs new predicted value (first six feature model\",\n       x = \"Actual Body Fat (%)\",\n       y = \"Predicted Body Fat (%)\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Box plot: Comparison of actual value and new predicted value distribution\ncomparison_new <- test_data %>%\n  select(BodyFat, Predicted_BodyFat_New) %>%\n  pivot_longer(cols = c(BodyFat, Predicted_BodyFat_New),\n               names_to = \"Method\",\n               values_to = \"BodyFat\")\n\nggplot(comparison_new, aes(x = Method, y = BodyFat, fill = Method)) +\n  geom_boxplot() +\n  labs(title = \"Distribution of Actual and Predicted Body Fat\",\n       x = \"method\",\n       y = \"Body fat (%)\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# Calculation error index\nmse_new <- mean((test_data$BodyFat - test_data$Predicted_BodyFat_New)^2)\nmae_new <- mean(abs(test_data$BodyFat - test_data$Predicted_BodyFat_New))\n\n# Printing error index\ncat(\"Mean Squared Error (MSE):\", mse_new, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMean Squared Error (MSE): 19.98987 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Mean Absolute Error (MAE):\", mae_new, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMean Absolute Error (MAE): 3.533513 \n```\n\n\n:::\n:::\n\n\nConclusion:\n\nCompare the MSE and MAE of the two comparative analyses. The second prediction has a higher error. Therefore, the conclusion is that the second analysis method failed. More analysis directions are needed in the future to determine how to accurately analyze body fat percentage with the same body indicators.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}